{"paragraphs":[{"title":"Import Libraries","text":"%pyspark\nimport justext","user":"anonymous","dateUpdated":"2018-09-25T16:04:49+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537891482337_1953691994","id":"20180925-160442_1883439862","dateCreated":"2018-09-25T16:04:42+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:12750"},{"title":"Read Uncleaned JSON","text":"%pyspark\nhtmlDF = spark.read.json(\"/share_dir/attack_westminster_small_uncleaned.json\")\nhtmlDF.show()\nhtmlDF.count()","user":"anonymous","dateUpdated":"2018-09-26T18:06:53+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------------+--------------+--------------------+\n|         originalUrl|                text|     timestamp|               title|\n+--------------------+--------------------+--------------+--------------------+\n|https://www.thegu...|<body id=\"top\" cl...|20180919054602|Westminster attac...|\n|http://news.sky.c...|<body data-sn-bas...|20180919054956|Anti-terror barri...|\n|https://www.thegu...|<body id=\"top\" cl...|20180919054546|The numbing after...|\n|http://www.financ...|<body>   ​​​  <me...|20180919054621|London terror att...|\n|https://www.newst...|<body class=\"html...|20180919055205|People in Westmin...|\n|https://www.buzzf...|<body>   <a data-...|20180919054334|Here's The Misinf...|\n|http://news.googl...|<body id=\"asset-t...|20180919054926|London attack: Fo...|\n|https://www.stand...|<body id=\"body\" [...|20180919054327|Taliban bomb-make...|\n|http://www.unilad...|<body class=\"erro...|20180919054346|Page not found - ...|\n|https://www.rt.co...|<body>   <div cla...|20180919055240|British politicia...|\n|http://www.opinie...|<body id=\"phpbb\" ...|20180919055100|Muslim leaders ho...|\n|https://uk.news.y...|<body>  <div id=\"...|20180919055040|Phillip Schofield...|\n|http://www.mirror...|<body bgcolor=\"wh...|20180919054327|       403 Forbidden|\n|http://www.examin...|<body class=\"arti...|20180919054618|Westminster terro...|\n|http://chasecarbo...|<body>   <!-- Nav...|20180919054357|Chase Carbon - Tr...|\n|https://www.thegu...|<body id=\"top\" cl...|20180919054254|Westminster attac...|\n|https://umurka.00...|<body>   <div cla...|20180919054404|Website is no lon...|\n|https://www.expre...|<body itemscope i...|20180919054808|London terror att...|\n|http://politricks...|<body>  <script t...|20180919054743|          Loading...|\n|https://www.justg...|<body>   <div id=...|20180919055142|Crowdfunding to h...|\n+--------------------+--------------------+--------------+--------------------+\nonly showing top 20 rows\n\n459\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=105","http://172.17.0.2:4040/jobs/job?id=106","http://172.17.0.2:4040/jobs/job?id=107"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1537886068126_578682731","id":"20180925-143428_318812804","dateCreated":"2018-09-25T14:34:28+0000","dateStarted":"2018-09-26T18:06:53+0000","dateFinished":"2018-09-26T18:06:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12751"},{"title":"Clean Using JusText","text":"%pyspark\n\ndef htmlClean(htmlText):\n    if type(htmlText) not in [str, unicode]:\n        raise Exception(str(type(htmlText)) + \" is not a valid type.\")\n    paragraphs = justext.justext(htmlText, justext.get_stoplist(\"English\"))\n    return ' '.join([p.text for p in paragraphs if not p.is_boilerplate])\n\ncleanedDF = htmlDF.rdd.filter(lambda x: x.text != '').map(lambda x: (x.title, x.originalUrl, htmlClean(x.text))).filter(lambda x: x[2] != '').toDF().withColumnRenamed(\"_1\", \"title\").withColumnRenamed(\"_2\", \"originalUrl\").withColumnRenamed(\"_3\", \"text\")\ncleanedDF.show()\ncleanedDF.count()","user":"anonymous","dateUpdated":"2018-09-26T21:08:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------------+--------------------+\n|               title|         originalUrl|                text|\n+--------------------+--------------------+--------------------+\n|Westminster attac...|https://www.thegu...|London attack: po...|\n|Anti-terror barri...|http://news.sky.c...|London hospitals ...|\n|The numbing after...|https://www.thegu...|The mind goes num...|\n|London terror att...|http://www.financ...|Five people died ...|\n|People in Westmin...|https://www.newst...|People in Westmin...|\n|Here's The Misinf...|https://www.buzzf...|The Metropolitan ...|\n|London attack: Fo...|http://news.googl...|Media captionFoot...|\n|Taliban bomb-make...|https://www.stand...|Popular Videos Kh...|\n|Page not found - ...|http://www.unilad...|Not Found This is...|\n|British politicia...|https://www.rt.co...|Ellwood, who has ...|\n|Muslim leaders ho...|http://www.opinie...|[phpBB Debug] PHP...|\n|Phillip Schofield...|https://uk.news.y...|Phillip Schofield...|\n|Westminster attac...|https://www.thegu...|PM visits injured...|\n|London terror att...|https://www.expre...|Express.co.uk rel...|\n|'Love for all, ha...|http://www.watfor...|Watford Muslims j...|\n|Subscribe to read...|https://www.ft.co...|Subscribe to the ...|\n|Police officer st...|https://stv.tv/ne...|Postcode iThere a...|\n|Officer who witne...|http://terrorism....|Officer who witne...|\n|Video shows injur...|http://www.reuter...|Video shows injur...|\n|Police told NOT t...|http://www.expres...|POLICE officers a...|\n+--------------------+--------------------+--------------------+\nonly showing top 20 rows\n\n299\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=122","http://172.17.0.2:4040/jobs/job?id=123","http://172.17.0.2:4040/jobs/job?id=124"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1537886659247_-1885357385","id":"20180925-144419_959070676","dateCreated":"2018-09-25T14:44:19+0000","dateStarted":"2018-09-26T21:08:20+0000","dateFinished":"2018-09-26T21:08:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12752"},{"title":"Write To HDFS","text":"%pyspark\n# This will write to HDFS in a partitioned glob. \n# You can import it using pyspark without combining the glob.\n# You can fetch the merged glob by using `hdfs dfs -getmerge`:\n# https://hadoop.apache.org/docs/r2.7.3/hadoop-project-dist/hadoop-common/FileSystemShell.html#getmerge\ncleanedDF.write.json('/share_dir/attack_westminster_small_cleaned.json')","user":"anonymous","dateUpdated":"2018-09-25T16:07:03+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 2: cleanedDF.write.json('/share_dir/attack_westminster_small_cleaned.json')\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-4001337537110474312.py\", line 380, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 2, in <module>\n  File \"/archive_spark/spark-2.2.1-bin-hadoop2.7/python/lib/pyspark.zip/pyspark/sql/readwriter.py\", line 665, in json\n    self._jwrite.json(path)\n  File \"/archive_spark/spark-2.2.1-bin-hadoop2.7/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1133, in __call__\n    answer, self.gateway_client, self.target_id, self.name)\n  File \"/archive_spark/spark-2.2.1-bin-hadoop2.7/python/lib/pyspark.zip/pyspark/sql/utils.py\", line 69, in deco\n    raise AnalysisException(s.split(': ', 1)[1], stackTrace)\nAnalysisException: u'path file:/share_dir/attack_westminster_small_cleaned.json already exists.;'\n"}]},"apps":[],"jobName":"paragraph_1537890874734_-2128882787","id":"20180925-155434_655608613","dateCreated":"2018-09-25T15:54:34+0000","dateStarted":"2018-09-25T16:06:10+0000","dateFinished":"2018-09-25T16:06:10+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:12753"},{"text":"%pyspark","user":"anonymous","dateUpdated":"2018-09-25T16:06:15+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537891570298_1134556335","id":"20180925-160610_634397315","dateCreated":"2018-09-25T16:06:10+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:12754"}],"name":"JusText Clean","id":"2DQEGXD7M","noteParams":{},"noteForms":{},"angularObjects":{"python:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}